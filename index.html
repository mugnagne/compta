<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compta Neuille - ANTIAUDENCIA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,400;1,700&family=Roboto+Mono:wght@400;700&family=Inter:wght@400;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --neon-yellow: #ccff00;
            --dark: #1a1a1a;
            --paper: #ffffff;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: var(--dark);
            background-image: radial-gradient(#d1d5db 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .font-serif-header { font-family: 'Playfair Display', serif; }
        .font-mono-code { font-family: 'Roboto Mono', monospace; }

        /* Styles "Sketchy" */
        .sketchy-card {
            background: var(--paper);
            border: 2px solid var(--dark);
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
            box-shadow: 3px 3px 0px 0px rgba(0,0,0,0.8);
            transition: all 0.2s ease;
            color: var(--dark);
            position: relative;
        }
        .sketchy-card:hover {
            transform: translateY(-2px) rotate(1deg);
            box-shadow: 5px 5px 0px 0px var(--neon-yellow);
            z-index: 50;
        }

        /* Zones de dépôt */
        .drop-zone {
            transition: background-color 0.3s, border-color 0.3s;
            border: 2px dashed #9ca3af;
            background-color: rgba(255, 255, 255, 0.5);
        }
        .drop-zone:hover {
            border-color: var(--dark);
            background-color: rgba(255, 255, 255, 0.9);
        }

        .zone-group-title {
            background: var(--dark);
            color: var(--neon-yellow);
            display: inline-block;
            padding: 4px 12px;
            font-weight: bold;
            transform: rotate(-1deg);
            margin-bottom: 8px;
            box-shadow: 3px 3px 0px 0px rgba(0,0,0,0.2);
        }

        /* Feedback validation */
        .valid-success { 
            background-color: #d9f99d !important; 
            border-color: #365314; 
        }
        .valid-error { 
            background-color: #fca5a5 !important; 
            border-color: #7f1d1d; 
        }

        .dragging { opacity: 0.4; transform: scale(0.9); }
        
        .ledger-column {
            background: #fff;
            border: 3px solid var(--dark);
            padding: 1rem;
            border-radius: 2px 20px 3px 20px / 20px 3px 20px 3px; 
        }

        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    </style>
</head>
<body class="selection:bg-[#ccff00] min-h-screen">

    <div class="max-w-[1400px] mx-auto p-4 md:p-6 pb-32">
        
        <header class="mb-8 flex flex-col md:flex-row justify-between items-end border-b-4 border-gray-900 pb-4 border-double">
            <div>
                <div class="flex items-center gap-3">
                    <h1 class="text-3xl md:text-4xl font-extrabold tracking-tighter uppercase italic transform -rotate-1">
                        Compta<span class="text-[#ccff00] bg-gray-900 px-2">Neuille</span>
                    </h1>
                    <span class="bg-gray-200 text-xs px-2 py-1 font-mono-code rounded border border-gray-400">ANTIAUDENCIA</span>
                </div>
                
                <h2 id="company-name" class="mt-4 text-2xl md:text-3xl font-serif-header font-bold text-gray-800 border-b-2 border-[#ccff00] inline-block pr-6">
                    Chargement...
                </h2>
            </div>
            
            <button onclick="initGame()" class="mt-4 md:mt-0 px-6 py-2 bg-white border-2 border-gray-900 shadow-[4px_4px_0px_0px_#ccff00] hover:translate-x-[2px] hover:translate-y-[2px] hover:shadow-none transition-all font-bold font-mono-code uppercase text-sm cursor-pointer flex items-center gap-2">
                <span>⚡</span> Nouvelle Entreprise
            </button>
        </header>

        <div class="grid grid-cols-1 xl:grid-cols-12 gap-6">
            
            <div class="xl:col-span-2">
                <div class="bg-gray-800 p-4 border-2 border-gray-900 min-h-[500px] rounded-lg relative shadow-xl">
                    <h3 class="text-neon-yellow font-bold mb-4 font-mono-code flex items-center gap-2 uppercase text-sm tracking-widest">
                        flux_entrant
                    </h3>
                    <div id="source-zone" class="space-y-3 min-h-[400px]" ondrop="drop(event)" ondragover="allowDrop(event)" data-type="TODO">
                        </div>
                </div>
            </div>

            <div class="xl:col-span-10 flex flex-col gap-6">
                
                <div class="grid md:grid-cols-2 gap-4">
                    
                    <div class="ledger-column relative">
                        <div class="absolute -top-4 left-4 zone-group-title transform -rotate-2">
                            CHARGES (Cl. 6)
                        </div>
                        
                        <div class="mt-4 space-y-4">
                            <div class="drop-zone p-3 rounded-lg" ondrop="drop(event)" ondragover="allowDrop(event)" data-type="CHARGE" data-subtype="EXPLOIT">
                                <p class="text-xs font-bold text-gray-500 uppercase mb-2 font-mono-code">Exploitation (60-65)</p>
                                <div id="zone-charge-exploit" class="min-h-[60px] space-y-2"></div>
                            </div>
                            <div class="drop-zone p-3 rounded-lg" ondrop="drop(event)" ondragover="allowDrop(event)" data-type="CHARGE" data-subtype="FINANCE">
                                <p class="text-xs font-bold text-gray-500 uppercase mb-2 font-mono-code">Financières (66)</p>
                                <div id="zone-charge-finance" class="min-h-[60px] space-y-2"></div>
                            </div>
                            <div class="drop-zone p-3 rounded-lg" ondrop="drop(event)" ondragover="allowDrop(event)" data-type="CHARGE" data-subtype="EXCEP">
                                <p class="text-xs font-bold text-gray-500 uppercase mb-2 font-mono-code">Exceptionnelles (67)</p>
                                <div id="zone-charge-excep" class="min-h-[60px] space-y-2"></div>
                            </div>
                        </div>
                    </div>

                    <div class="ledger-column relative">
                         <div class="absolute -top-4 right-4 zone-group-title transform rotate-1">
                            PRODUITS (Cl. 7)
                        </div>

                        <div class="mt-4 space-y-4">
                            <div class="drop-zone p-3 rounded-lg" ondrop="drop(event)" ondragover="allowDrop(event)" data-type="PRODUIT" data-subtype="EXPLOIT">
                                <p class="text-xs font-bold text-gray-500 uppercase mb-2 font-mono-code text-right">Exploitation (70-75)</p>
                                <div id="zone-produit-exploit" class="min-h-[60px] space-y-2"></div>
                            </div>
                            <div class="drop-zone p-3 rounded-lg" ondrop="drop(event)" ondragover="allowDrop(event)" data-type="PRODUIT" data-subtype="FINANCE">
                                <p class="text-xs font-bold text-gray-500 uppercase mb-2 font-mono-code text-right">Financiers (76)</p>
                                <div id="zone-produit-finance" class="min-h-[60px] space-y-2"></div>
                            </div>
                            <div class="drop-zone p-3 rounded-lg" ondrop="drop(event)" ondragover="allowDrop(event)" data-type="PRODUIT" data-subtype="EXCEP">
                                <p class="text-xs font-bold text-gray-500 uppercase mb-2 font-mono-code text-right">Exceptionnels (77)</p>
                                <div id="zone-produit-excep" class="min-h-[60px] space-y-2"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-200 border-4 border-dashed border-gray-400 p-4 rounded-xl relative"
                     ondrop="drop(event)" ondragover="allowDrop(event)" data-type="BILAN" data-subtype="BILAN">
                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-gray-400 text-white px-3 py-1 text-xs font-bold rounded-full">
                        HORS RÉSULTAT (BILAN - CL. 1 à 5)
                    </div>
                    <div id="zone-bilan" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3 mt-2 min-h-[80px]"></div>
                </div>

            </div>
        </div>

        <div class="fixed bottom-0 left-0 w-full bg-white border-t-2 border-gray-900 p-4 shadow-[0_-5px_15px_rgba(0,0,0,0.1)] flex justify-between items-center z-50">
            <div class="text-sm font-mono-code text-gray-500 hidden md:block pl-4">
                Glisse les opérations. Clique sur vérifier pour corriger.
            </div>
            
            <div class="flex items-center gap-6 mx-auto md:mx-0 pr-4">
                 <div id="result-area" class="hidden flex items-center gap-4">
                    <span id="score-display" class="text-3xl font-black font-mono-code"></span>
                    <span id="feedback-text" class="font-serif-header italic text-sm md:text-base max-w-[300px] leading-tight"></span>
                </div>

                <button id="validate-btn" onclick="validate()" class="px-8 py-3 bg-gray-900 text-[#ccff00] font-bold uppercase tracking-widest hover:bg-[#ccff00] hover:text-gray-900 border-2 border-gray-900 transition-colors shadow-lg cursor-pointer">
                    Vérifier
                </button>
            </div>
        </div>

    </div>

    <script>
        // --- NOMS D'ENTREPRISES (CLEAN & DARK HUMOR) ---
        const prefixes = [
            "Pompes Funèbres", "Kebab", "Auto-École", "Clinique Esthétique", "Start-up", 
            "Boucherie", "Agence Matrimoniale", "Pizzeria", "Crèche", "Pharmacie", 
            "Salle de Sport", "EHPAD", "Night Club", "Cabinet d'Avocats", "Camping",
            "Agence de Détectives", "Salle d'Arcade"
        ];
        
        const suffixes = [
            "'À Bientôt'", "'Viande Mystère'", "'Le Mur'", "'Low Cost'", "'Ponzi Scheme'", 
            "'Végane (ou pas)'", "'Désespoir'", "'L'Impasse'", "'Le Petit Spartiate'", "'Placebo'",
            "'No Pain No Gain'", "'Dernier Souffle'", "'L'Amnésie'", "'Divorce Express'", 
            "'Blanchiment Facile'", "'Chat Perdu'", "'Fisc & Furious'", "'Dépôt de Bilan'"
        ];

        function generateCompanyName() {
            const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
            const suffix = suffixes[Math.floor(Math.random() * suffixes.length)];
            return `${prefix} ${suffix}`;
        }

        // --- DATA & LOGIQUE (SERIEUX PCG) ---
        const TYPES = { CHARGE: 'CHARGE', PRODUIT: 'PRODUIT', BILAN: 'BILAN' };
        const SUBS = { EXPLOIT: 'EXPLOIT', FINANCE: 'FINANCE', EXCEP: 'EXCEP', BILAN: 'BILAN' };

        const DATABASE = [
            // EXPLOITATION (Charges)
            { label: "Achat matières premières", type: TYPES.CHARGE, sub: SUBS.EXPLOIT, code: '601' },
            { label: "Location immobilière", type: TYPES.CHARGE, sub: SUBS.EXPLOIT, code: '613' },
            { label: "Primes d'assurances", type: TYPES.CHARGE, sub: SUBS.EXPLOIT, code: '616' },
            { label: "Rémunération personnel", type: TYPES.CHARGE, sub: SUBS.EXPLOIT, code: '641' },
            { label: "Publicité & publipostage", type: TYPES.CHARGE, sub: SUBS.EXPLOIT, code: '623' },
            { label: "Entretien et réparations", type: TYPES.CHARGE, sub: SUBS.EXPLOIT, code: '615' },

            // FINANCIER (Charges)
            { label: "Charges d'intérêts", type: TYPES.CHARGE, sub: SUBS.FINANCE, code: '661' },
            { label: "Pertes de change", type: TYPES.CHARGE, sub: SUBS.FINANCE, code: '666' },

            // EXCEPTIONNEL (Charges)
            { label: "Pénalités et amendes", type: TYPES.CHARGE, sub: SUBS.EXCEP, code: '671' },
            { label: "VNC élts d'actif cédés", type: TYPES.CHARGE, sub: SUBS.EXCEP, code: '675' },

            // EXPLOITATION (Produits)
            { label: "Vente de marchandises", type: TYPES.PRODUIT, sub: SUBS.EXPLOIT, code: '707' },
            { label: "Prestations de services", type: TYPES.PRODUIT, sub: SUBS.EXPLOIT, code: '706' },
            { label: "Subvention exploitation", type: TYPES.PRODUIT, sub: SUBS.EXPLOIT, code: '740' },
            
            // FINANCIER (Produits)
            { label: "Gains de change", type: TYPES.PRODUIT, sub: SUBS.FINANCE, code: '766' },
            { label: "Produits participations", type: TYPES.PRODUIT, sub: SUBS.FINANCE, code: '761' },
            
            // EXCEPTIONNEL (Produits)
            { label: "Produits cession d'actif", type: TYPES.PRODUIT, sub: SUBS.EXCEP, code: '775' },
            { label: "Dégrèvement d'impôts", type: TYPES.PRODUIT, sub: SUBS.EXCEP, code: '777' },
            
            // BILAN (Mélange Actif/Passif)
            { label: "Matériel de transport", type: TYPES.BILAN, sub: SUBS.BILAN, code: '2182' },
            { label: "Capital Social", type: TYPES.BILAN, sub: SUBS.BILAN, code: '101' },
            { label: "Emprunts bancaires", type: TYPES.BILAN, sub: SUBS.BILAN, code: '164' },
            { label: "Stocks de marchandises", type: TYPES.BILAN, sub: SUBS.BILAN, code: '37' },
            { label: "TVA à décaisser", type: TYPES.BILAN, sub: SUBS.BILAN, code: '4455' },
            { label: "Créances clients", type: TYPES.BILAN, sub: SUBS.BILAN, code: '411' },
            { label: "Dettes fournisseurs", type: TYPES.BILAN, sub: SUBS.BILAN, code: '401' },
        ];

        function initGame() {
            document.getElementById('company-name').innerText = generateCompanyName();

            const zones = ['source-zone', 'zone-charge-exploit', 'zone-charge-finance', 'zone-charge-excep',
                'zone-produit-exploit', 'zone-produit-finance', 'zone-produit-excep', 'zone-bilan'];
            zones.forEach(id => document.getElementById(id).innerHTML = '');
            
            document.getElementById('result-area').classList.add('hidden');
            document.getElementById('validate-btn').innerText = "Vérifier";
            document.getElementById('validate-btn').classList.remove('bg-[#ccff00]', 'text-gray-900');
            document.getElementById('validate-btn').classList.add('bg-gray-900', 'text-[#ccff00]');

            const shuffled = [...DATABASE].sort(() => 0.5 - Math.random()).slice(0, 9);

            shuffled.forEach((op, index) => {
                const amount = Math.floor(Math.random() * 5000) + 50;
                const id = `op-${index}`;
                const card = createCard(id, op, amount);
                document.getElementById('source-zone').appendChild(card);
            });
        }

        function createCard(id, op, amount) {
            const div = document.createElement('div');
            div.id = id;
            div.className = "sketchy-card p-3 cursor-grab animate-pop"; 
            div.draggable = true;
            div.dataset.type = op.type;
            div.dataset.sub = op.sub;

            div.innerHTML = `
                <div class="flex justify-between items-start pointer-events-none">
                    <span class="font-bold text-sm leading-tight pr-2">${op.label}</span>
                    <span class="font-mono-code text-xs bg-gray-200 px-1 rounded text-gray-800">${op.code}</span>
                </div>
                <div class="mt-2 text-right font-mono-code text-xs text-gray-500 pointer-events-none">
                    ${amount} €
                </div>
            `;

            div.addEventListener('dragstart', (e) => {
                // Au début du drag, on enlève les couleurs de validation pour "nettoyer" la carte
                e.target.classList.remove('valid-success', 'valid-error');
                e.dataTransfer.setData("text", e.target.id);
                setTimeout(() => e.target.classList.add('dragging'), 0);
            });
            div.addEventListener('dragend', (e) => {
                e.target.classList.remove('dragging');
            });
            return div;
        }

        function allowDrop(ev) { ev.preventDefault(); }

        function drop(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            const draggedElement = document.getElementById(data);
            if(!draggedElement) return;

            let target = ev.target;
            while (target && !target.hasAttribute('ondrop')) {
                target = target.parentNode;
            }
            if (!target) return;

            let targetId;
            const type = target.dataset.type;
            const sub = target.dataset.subtype;

            if (type === 'TODO') targetId = 'source-zone';
            else if (type === 'BILAN') targetId = 'zone-bilan';
            else if (type === 'CHARGE') {
                if (sub === 'EXPLOIT') targetId = 'zone-charge-exploit';
                if (sub === 'FINANCE') targetId = 'zone-charge-finance';
                if (sub === 'EXCEP') targetId = 'zone-charge-excep';
            }
            else if (type === 'PRODUIT') {
                if (sub === 'EXPLOIT') targetId = 'zone-produit-exploit';
                if (sub === 'FINANCE') targetId = 'zone-produit-finance';
                if (sub === 'EXCEP') targetId = 'zone-produit-excep';
            }

            if (targetId) {
                document.getElementById(targetId).appendChild(draggedElement);
                // Petite rotation pour le style
                draggedElement.style.transform = `rotate(${Math.random() * 2 - 1}deg)`;
            }
        }

        function validate() {
            let total = 0;
            let errors = 0;

            // On sélectionne toutes les zones de jeu (sauf la source)
            const dropZones = document.querySelectorAll('.drop-zone, [data-type="BILAN"]');

            dropZones.forEach(zone => {
                // Trouver le container qui contient les cartes à l'intérieur de la zone
                // Si la zone est un div simple (comme BILAN), c'est l'ID interne
                // Si la zone est une drop-zone complex, on cherche le div enfant direct qui stocke les items
                let itemContainer = zone.querySelector('div[id^="zone-"]');
                if (!itemContainer && zone.id && zone.id.startsWith('zone-bilan')) {
                    itemContainer = document.getElementById('zone-bilan'); // Cas spécial pour le bilan qui a l'ID directement sur le conteneur interne
                }
                if (!itemContainer && zone.dataset.type === 'BILAN') {
                     itemContainer = document.getElementById('zone-bilan');
                }
                
                if (!itemContainer) return; // Sécurité

                const expectedType = zone.dataset.type;
                const expectedSub = zone.dataset.subtype;
                
                const items = itemContainer.children;

                for (let item of items) {
                    total++;
                    const itemType = item.dataset.type;
                    const itemSub = item.dataset.sub;
                    let isCorrect = false;

                    // Logique de validation
                    if (expectedType === 'BILAN') {
                        // Pour le bilan, on vérifie juste que l'item est de type BILAN
                        if (itemType === 'BILAN') isCorrect = true;
                    } else {
                        // Pour le compte de résultat, Type ET Sous-Type doivent matcher
                        if (expectedType === itemType && expectedSub === itemSub) {
                            isCorrect = true;
                        }
                    }

                    // Application du style
                    item.classList.remove('valid-success', 'valid-error');
                    if (isCorrect) {
                        item.classList.add('valid-success');
                    } else {
                        item.classList.add('valid-error');
                        errors++;
                    }
                }
            });

            // Pénalité pour les items restés dans la zone de départ
            const leftOvers = document.getElementById('source-zone').children.length;
            total += leftOvers;
            // On compte les leftovers comme incomplets, donc impactent le score, mais pas comme erreur rouge.

            const score = total === 0 ? 0 : Math.round(((total - (errors + leftOvers)) / total) * 100);

            // Affichage UI
            const resultArea = document.getElementById('result-area');
            const feedback = document.getElementById('feedback-text');
            const scoreDisplay = document.getElementById('score-display');
            const btn = document.getElementById('validate-btn');
            
            resultArea.classList.remove('hidden');
            scoreDisplay.innerText = `${score}%`;
            
            if (score === 100) {
                scoreDisplay.className = "text-3xl font-black font-mono-code text-[#ccff00] bg-gray-900 px-2 transform -rotate-3 inline-block";
                feedback.innerText = "Bilan équilibré. Parfait.";
                btn.innerText = "Tout Bon !";
            } else if (score >= 70) {
                scoreDisplay.className = "text-3xl font-black font-mono-code text-gray-900";
                feedback.innerText = "Pas mal. Corrige les rouges et réessaie.";
                btn.innerText = "Re-vérifier";
            } else {
                scoreDisplay.className = "text-3xl font-black font-mono-code text-red-600";
                feedback.innerText = "Catastrophique. Déplace les cartes rouges.";
                btn.innerText = "Re-vérifier";
            }
        }

        // Démarrage
        initGame();

    </script>
</body>
</html>
